# Meal Planner CLI

The Meal Planner CLI generates weekly meal plans from a recipe catalogue and
produces grocery lists based on the resulting plan. Install the project and run
it with Python 3.11 or newer.

## Installation

### Using uv (recommended)

[`uv`](https://docs.astral.sh/uv/) manages dependencies and virtual
environments directly from `pyproject.toml`.

```bash
uv sync
```

This creates a virtual environment (stored in `.venv/`) and installs
dependencies pinned in `uv.lock`. Run commands within the environment using
`uv run`:

```bash
uv run mealplanner --help
```

### With pip

```bash
pip install -e .
```

Alternatively, invoke the module directly with `python -m mealplanner` from the
repository root.

## Usage

The CLI provides two subcommands: `plan` to create a weekly plan and `groceries`
to build shopping lists from an existing plan.

### Generate a meal plan

```bash
mealplanner plan \
  --recipes data/recipes.yml \
  --config configs/week.yml \
  --out-md out/plan.md \
  --out-json out/plan.json
```

* `--recipes` – Path to a YAML or JSON file containing the recipe catalogue, or a
  directory of JSON files (each may contain a single recipe object or a list of
  recipes).
* `--config` – Path to the weekly planning configuration.
* `--out-md` – Destination for the rendered Markdown plan.
* `--out-json` – Destination for the structured plan data.
* `--history` *(optional)* – Path to a JSON file used to avoid repeating
  recent recipes. When provided, the new plan is recorded to the same file.
* `--seed` *(optional)* – Integer seed for deterministic plan generation.

### Generate grocery outputs

After creating a plan, produce grocery tables and Markdown summaries:

```bash
mealplanner groceries \
  --recipes data/recipes.yml \
  --config configs/week.yml \
  --plan out/plan.json \
  --out-csv out/groceries.csv \
  --out-md out/groceries.md
```

* `--plan` – Path to the JSON plan generated by the `plan` command.
* `--out-csv` – Destination for a CSV-formatted grocery table.
* `--out-md` – Destination for a Markdown grocery list.

## Example workflow

1. Prepare recipe, configuration, and optional history files in the `data/` and
   `configs/` directories.
2. Run `mealplanner plan` to create `out/plan.json` and `out/plan.md`.
3. Run `mealplanner groceries` to generate grocery outputs in `out/`.
4. Share or archive the Markdown and CSV files as needed.

Refer to `SPEC.md` for the comprehensive feature specification if required.

## Converting unstructured recipes with an LLM

Use `scripts/convert_recipes.py` to turn a directory of plain-text recipes into
schema-compliant JSON files by delegating extraction to an OpenAI-compatible
language model endpoint. The script validates the structured response against
`schemas/recipe.schema.json` and writes one JSON file per recipe.

```bash
python scripts/convert_recipes.py raw_recipes/ structured_recipes/ \
  --model gpt-4.1-mini \
  --base-url "https://api.openai.com/v1" \
  --raw-output-dir tmp/raw_llm
```

Key options:

* `--api-key`, `--base-url`, and `--model` (or the `OPENAI_API_KEY`,
  `OPENAI_BASE_URL`, `OPENAI_MODEL` environment variables) configure the target
  endpoint.
* `--use-chat-completions` switches from the Responses API to the classic Chat
  Completions API for local deployments that do not implement the Responses
  interface.
* `--overwrite` allows replacing existing JSON files. By default the script
  refuses to overwrite.
* `--raw-output-dir` saves the untouched LLM output for debugging.

Every generated recipe is validated with `jsonschema` before it is written, and
the script exits with an error if validation fails.
